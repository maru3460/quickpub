# 開発ガイドライン：Webサイト公開プラットフォーム (改訂版)

## 1. はじめに

本文書は、「Webサイト公開プラットフォーム」開発プロジェクトを円滑に進めるためのガイドラインです。ユーザー様からのフィードバックを全面的に反映し、特に **AIペアプログラマー (Cline+Claude) との効率的な連携** と、そのための **「コンテキストウィンドウ節約のためのドキュメント手法」** に重点を置いて改訂しました。

このドキュメントと、`docs/` ディレクトリに集約された各種ドキュメント群を効果的に活用することで、開発者は次に何をすべきか、どこに情報があるのかを迷うことなく把握し、AIの能力を最大限に引き出しながら効率的に開発を進めることを目的とします。

## 2. 開発のコアコンセプト: 「ドキュメント駆動開発 with AI」

本プロジェクトでは、以下のコンセプトに基づいて開発を進めます。

-   **ドキュメント中心主義**: 全ての重要な情報（設計、仕様、ルール、手順、知見）は `docs/` ディレクトリ内のMarkdownファイルに集約・記録します。
-   **AIとの協調**: Cline+Claudeを単なるコード生成器としてではなく、プロジェクト情報を理解した上で能動的に支援してくれる「ペアプログラマー」として活用します。
-   **コンテキストの明示**: AIに作業を依頼する際は、`docs/` 内の関連ドキュメントを適切に参照させ、明確なコンテキストを提供します。

## 3. 開発の進め方 (AI連携強化版)

`clinerules_proposal_revised.md` で定義された基本的な開発フローを踏襲しつつ、AI連携を強化した進め方を以下に示します。

1.  **タスクの明確化とAIへの共有**:
    *   `todo.md` で現在のタスクとゴールを確認します。
    *   AIにタスク開始を宣言し、`todo.md` の該当項目と、`docs/` 内の関連ドキュメント（設計書、API仕様など）のパスを伝えます。
    *   例: 「`todo.md` の『ユーザー新規登録API作成』タスクを開始します。関連仕様は `docs/design/design_document.md` のセクションX.Xと、`docs/api/swagger.yaml` の `/users` エンドポイント定義を参照してください。」

2.  **ブランチ作成**: `clinerules_proposal_revised.md` に従いブランチを作成します。

3.  **実装 (AIとのペアプログラミング)**:
    *   **ファイル特定とコンテキスト提供**: AIに作業対象のファイル名を伝え、必要に応じて既存コードの関連部分や `docs/` 内の規約（`clinerules.md` のコーディング規約部分など）を提示します。
    *   **段階的な指示と確認**: 複雑な機能は小さなステップに分割し、各ステップごとにAIに指示を出します。生成されたコードや提案を都度確認し、フィードバックを与えながら進めます。
    *   **ドキュメント参照指示**: 「`docs/development/clinerules.md` のRubyコーディング規約に従ってリファクタリングしてください」のように、AIにドキュメントを参照させながら作業を進めます。

4.  **テスト (AIによるテストケース補助)**:
    *   `clinerules_proposal_revised.md` のテスト方針に基づきテストを作成します。
    *   AIに「この関数の正常系テストケースをVitestで記述してください。テスト対象は `client/src/services/authService.ts` の `login` 関数です」のように、テストコード作成の補助を依頼できます。

5.  **コミット**: `clinerules_proposal_revised.md` のコミット規約に従います。

6.  **Pull Request (PR) とセルフレビュー**: PR作成後、セルフレビューを行います。

7.  **マージと動作確認**

8.  **`todo.md` 更新**

9.  **知見のドキュメント化**: 開発中に得られた新しい知見、解決した問題、決定事項などは、適宜 `docs/` 以下の適切な場所にMarkdownファイルとして記録します。これにより、将来の自分やAIが参照できる知識ベースを構築します。
    *   例: `docs/troubleshooting/database_connection_error.md`

## 4. 「コンテキストウィンドウ節約」のためのドキュメント手法

AIペアプログラマーのコンテキストウィンドウには限りがあります。この制約の中でAIの能力を最大限に活用するため、以下のドキュメント手法を推奨します。

### 4.1. `docs/` ディレクトリの戦略的活用

-   **情報集約ハブ**: `docs/` ディレクトリをプロジェクトの全ての情報のハブと位置づけます。AIに何かを伝える際、「`docs/` のXXを参照」という指示を基本とします。
-   **ファイル分割と命名規則**: 長大なドキュメントは、関心事ごとにファイルを適切に分割します。ファイル名は内容を推測しやすいものにします (例: `docs/api/user_auth_api.md` より `docs/api/swagger.yaml` の方が標準的)。
-   **`docs/README.md`**: `docs/` ディレクトリのルートには、各サブディレクトリや主要ドキュメントの概要と、それらがどのような情報を含んでいるかを記述した `README.md` を配置します。AIが最初に参照する「目次」の役割を果たします。

### 4.2. AIへの効率的なコンテキスト提供方法

-   **ピンポイント参照**: AIに情報を渡す際は、巨大なファイル全体を渡すのではなく、該当するファイルパスと、可能であればセクション名や行番号、あるいは短い引用を提示します。
    *   例: 「`docs/development/clinerules.md` の『コミットメッセージ規約』セクションに従って、このコミットメッセージを修正してください。」
-   **要約とキーワード**: 長いドキュメントの内容をAIに理解させる必要がある場合、まずそのドキュメントの要点を数行でまとめ、キーワードと共にAIに伝えます。その後、詳細について質問があれば特定の箇所を参照させます。
-   **差分 (Diff) の活用**: 既存コードの修正を依頼する場合、変更点を示すdiff形式で指示すると、AIは変更の意図を正確に把握しやすくなります。
-   **会話の区切りと再確認**: 新しいタスクに移る際や、長時間の会話でAIが混乱しているように見える場合は、「ここまでの話は完了です。次に○○について、`docs/XXX.md` をベースに作業をお願いします」のように、明確に区切りを入れ、コンテキストを再設定します。
-   **ファイルパスの正確性**: `docs/` 内のファイルパスは常に正確に伝えます。相対パスよりも、プロジェクトルートからの絶対パス（例: `/home/ubuntu/my_rails_project/docs/...` のような形を意識しつつ、AIには `docs/...` の形式で伝える）が望ましいです。

### 4.3. ドキュメント自体の書き方の工夫

-   **Markdownの活用**: 見出し、リスト、コードブロック、表などを活用し、構造化された読みやすいドキュメントを作成します。これは人間だけでなく、AIにとっても解析しやすい形式です。
-   **一貫性のあるフォーマット**: 各ドキュメント内で見出しレベルや用語の使い方に一貫性を持たせます。
-   **具体的な記述**: 抽象的な表現を避け、具体的な手順、コード例、設定値などを記述します。
-   **更新の徹底**: 仕様変更や新しい決定事項があった場合は、速やかに関連ドキュメントを更新します。古い情報が残っているとAIが誤った前提で動作する可能性があります。

## 5. 主要ドキュメントとその役割 (再掲・`docs/` 連携強化)

-   **`docs/design/design_document.md` (ユーザー提供)**: プロジェクトの根幹。機能実装時は常にこのドキュメントの該当箇所をAIに伝え、仕様に基づいた開発を指示します。
-   **`docs/development/file_structure_proposal_revised.md`**: ファイルやディレクトリの配置ルール。新しいファイル作成時や既存コードの場所を探す際にAIに参照させます。
-   **`docs/development/clinerules_proposal_revised.md`**: コーディング規約、テスト方針など。コード生成やリファクタリングをAIに依頼する際の基準として参照させます。
-   **`docs/api/swagger.yaml`**: API仕様。RailsでのAPI実装時、ReactでのAPI呼び出し実装時にAIに参照させます。
-   **`docs/development/environment_setup.md`**: ローカル開発環境の構築手順。AIに環境構築に関する質問をする際のベース情報となります。
-   **`todo.md` (プロジェクトルート)**: タスク管理。AIとの作業開始・終了のトリガーとして活用します。
-   **本ガイドライン (`docs/development/development_guide_revised.md`)**: AIとの連携方法やドキュメント活用の基本方針。迷ったらここに戻り、AIとのコミュニケーション方法を見直します。

## 6. `todo.md` の運用 (AI連携)

-   タスクを細分化し、各タスクがどのドキュメントのどの部分に関連するのかを意識します。
-   AIにタスクを依頼する際、`todo.md` のタスク名を正確に伝え、関連ドキュメントへのポインタを添えることで、AIは作業内容を迅速に理解できます。

## 7. ローカル開発環境構築 (`docs/development/environment_setup.md` の作成指針)

ユーザー様のご要望に基づき、Dockerを使用しないローカル開発環境の構築手順を `docs/development/environment_setup.md` に詳細に記述します。このドキュメントは、AIに環境関連の質問をする際の基礎情報となります。

記載すべき項目例:
-   OS (Windows/macOS/Linux それぞれを想定)
-   必要なソフトウェアと推奨バージョン (Ruby, Rails, Node.js, Yarn/npm, PostgreSQL/MySQLなど)
-   各ソフトウェアのインストール手順 (OSごとのコマンド例)
-   プロジェクトのクローン手順
-   Rails側のセットアップ (bundle install, db:create, db:migrate, db:seedなど)
-   React側 (`client/`) のセットアップ (yarn install / npm install)
-   環境変数ファイル (`.env` など) の作成と設定項目
-   サーバー起動コマンド (Rails, React開発サーバー)
-   基本的な動作確認手順

このドキュメントは、AIが「あなたの環境ではXを試してみてください」といった具体的なアドバイスをする上で非常に重要になります。

## 8. まとめ

本開発ガイドラインは、ドキュメントを最大限に活用し、AIペアプログラマーとの連携を円滑にすることで、開発効率と品質を向上させることを目指しています。`docs/` ディレクトリを知識ベースとして育て、AIとのコミュニケーションにおける「共通言語」として活用してください。

プロジェクトの進行に合わせて、本ガイドラインやその他のドキュメントも適宜見直し、更新していくことが成功の鍵となります。

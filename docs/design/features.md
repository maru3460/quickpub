# 機能仕様

## 機能一覧

| 機能名              | 対象ユーザー | 概要                               |
| ------------------- | ------------ | ---------------------------------- |
| ユーザー登録        | admin        | システムへの新規ユーザー登録機能   |
| ログイン/ログアウト | 全ユーザー   | 認証機能                           |
| パスワード再設定    | 全ユーザー   | パスワード再設定機能               |
| サイト登録          | 全ユーザー   | サイトを登録し、公開する機能       |
| サイト編集          | 全ユーザー   | 登録したサイトを編集、削除する機能 |
| ユーザー設定        | 全ユーザー   | ユーザー情報の設定、編集機能       |

## 機能詳細

### ユーザー登録

#### 機能概要

管理者がシステムにアカウントを作成する機能

#### 画面遷移

1. ログインする
2. サイドバーの「管理者画面」をクリック
3. 管理者画面に遷移
4. 必要情報を入力し「登録」ボタンをクリック
5. 登録完了モーダル

#### 入力項目

| 項目名             | 必須 | 型・制約                | バリデーション     | 説明                                |
| ------------------ | ---- | ----------------------- | ------------------ | ----------------------------------- |
| メールアドレス     | ○    | 文字列（最大 255 文字） | メールアドレス形式 | ログイン ID、および連絡先として使用 |
| パスワード         | ○    | 文字列（8〜32 文字）    | 英数字記号混在     | アカウント認証用                    |
| パスワード（確認） | ○    | 文字列（8〜32 文字）    | パスワードと一致   | 確認用                              |
| 役割               | ○    | 選択肢                  | -                  | ユーザーの権限を設定                |

#### 処理フロー

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: 登録フォーム入力
    F->>F: 入力値検証
    F->>F: JWTトークン取得
    F->>B: ユーザー登録リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>B: 管理者権限確認
    B->>DB: ユーザー情報保存
    DB-->>B: 保存完了
    B-->>F: 登録完了レスポンス
    F-->>U: 登録完了モーダル表示
```

### ログイン/ログアウト

#### 機能概要

JWT（JSON Web Token）を使用したシステムへのログイン・ログアウト機能

#### 画面遷移（ログイン）

1. ログイン画面にアクセス
2. メールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック
4. 認証成功後、トップページに遷移

#### 画面遷移（ログアウト）

1. サイドバーの「ログアウト」をクリック
2. ログアウト処理後、ログイン画面に遷移

#### 入力項目（ログイン）

| 項目名         | 必須 | 型・制約                | バリデーション     | 説明                                |
| -------------- | ---- | ----------------------- | ------------------ | ----------------------------------- |
| メールアドレス | ○    | 文字列（最大 255 文字） | メールアドレス形式 | ログイン ID、および連絡先として使用 |
| パスワード     | ○    | 文字列（8〜32 文字）    | -                  | アカウント認証用                    |

#### 処理フロー（ログイン）

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: ログインフォーム入力
    F->>F: 入力値検証
    F->>B: 認証リクエスト
    B->>DB: ユーザー情報照会
    DB-->>B: ユーザー情報返却
    B->>B: パスワード検証
    B->>B: JWTトークン生成
    B-->>F: JWTトークン返却
    F->>F: JWTトークンをローカルストレージに保存
    F-->>U: トップページへ遷移（成功時）または<br>エラーメッセージ表示（失敗時）
```

#### 処理フロー（ログアウト）

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド

    U->>F: ログアウトボタンクリック
    F->>F: JWTトークンをローカルストレージから削除
    F-->>U: ログイン画面へ遷移
```

### パスワード再設定

#### 機能概要

パスワードを忘れた場合のリセット機能

#### 画面遷移

1. ログイン画面の「パスワードを忘れた場合」リンクをクリック
2. パスワード忘れた画面に遷移
3. メールアドレスを入力し「送信」ボタンをクリック
4. メール送信完了メッセージ表示
5. メールに記載されたリンクをクリック
6. パスワード再設定画面に遷移
7. 新しいパスワードを入力し「送信」ボタンをクリック
8. パスワードリセット完了メッセージ表示

#### 入力項目（パスワード忘れた画面）

| 項目名         | 必須 | 型・制約                | バリデーション     | 説明                   |
| -------------- | ---- | ----------------------- | ------------------ | ---------------------- |
| メールアドレス | ○    | 文字列（最大 255 文字） | メールアドレス形式 | 登録済みメールアドレス |

#### 入力項目（パスワード再設定画面）

| 項目名             | 必須 | 型・制約             | バリデーション   | 説明             |
| ------------------ | ---- | -------------------- | ---------------- | ---------------- |
| パスワード         | ○    | 文字列（8〜32 文字） | 英数字記号混在   | 新しいパスワード |
| パスワード（確認） | ○    | 文字列（8〜32 文字） | パスワードと一致 | 確認用           |

#### 処理フロー

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース
    participant M as メールサーバー

    U->>F: メールアドレス入力
    F->>B: パスワードリセットリクエスト
    B->>DB: ユーザー存在確認
    DB-->>B: ユーザー情報
    B->>B: JWT署名付きリセットトークン生成
    B->>M: リセットメール送信（JWT付きURL）
    M-->>U: リセットメール
    U->>F: リセットリンククリック
    F->>B: トークン検証リクエスト
    B->>B: JWTトークン検証
    B-->>F: 検証結果
    F-->>U: パスワード再設定フォーム表示
    U->>F: 新パスワード入力
    F->>B: パスワード更新リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: パスワード更新
    DB-->>B: 更新完了
    B-->>F: 更新完了レスポンス
    F-->>U: 完了メッセージ表示
```

### サイト登録

#### 機能概要

新しいサイトを登録し、公開する機能

#### 画面遷移

1. サイドバーの「新規サイト作成」をクリック
2. 新規サイト作成画面に遷移
3. 必要情報を入力し「公開する」ボタンをクリック
4. サイト編集画面に遷移

#### 入力項目

| 項目名       | 必須 | 型・制約                | バリデーション     | 説明                         |
| ------------ | ---- | ----------------------- | ------------------ | ---------------------------- |
| サイト名     | ○    | 文字列（最大 100 文字） | -                  | サイトの名称                 |
| サイトの説明 | ×    | 文字列（最大 500 文字） | -                  | サイトの説明                 |
| サブドメイン | ○    | 文字列（3〜63 文字）    | 英数字ハイフンのみ | 公開するサイトのサブドメイン |
| HTML         | ○    | テキスト                | -                  | サイトの HTML コード         |
| CSS          | ×    | テキスト                | -                  | サイトの CSS コード          |
| JavaScript   | ×    | テキスト                | -                  | サイトの JavaScript コード   |

#### 処理フロー

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: サイト情報入力
    F->>F: 入力値検証
    F->>F: JWTトークン取得
    F->>B: サイト登録リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: サブドメイン重複確認
    DB-->>B: 確認結果
    B->>DB: サイト情報保存（HTML/CSS/JSを含む）
    DB-->>B: 保存完了
    B-->>F: 登録完了レスポンス
    F-->>U: サイト編集画面へ遷移
```

### サイト編集

#### 機能概要

登録済みのサイトを編集・削除する機能

#### 画面遷移

1. サイドバーの「作成したサイト」をクリック
2. サイト一覧画面に遷移
3. 編集したいサイトの「編集」ボタンをクリック
4. サイト編集画面に遷移
5. 情報を編集し「更新する」ボタンをクリック、または「削除する」ボタンをクリック

#### 入力項目

| 項目名       | 必須 | 型・制約                | バリデーション     | 説明                         |
| ------------ | ---- | ----------------------- | ------------------ | ---------------------------- |
| サイト名     | ○    | 文字列（最大 100 文字） | -                  | サイトの名称                 |
| サイトの説明 | ×    | 文字列（最大 500 文字） | -                  | サイトの説明                 |
| サブドメイン | ○    | 文字列（3〜63 文字）    | 英数字ハイフンのみ | 公開するサイトのサブドメイン |
| HTML         | ○    | テキスト                | -                  | サイトの HTML コード         |
| CSS          | ×    | テキスト                | -                  | サイトの CSS コード          |
| JavaScript   | ×    | テキスト                | -                  | サイトの JavaScript コード   |

#### 処理フロー（更新）

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: サイト情報編集
    F->>F: 入力値検証
    F->>F: JWTトークン取得
    F->>B: サイト更新リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: サイト所有者確認
    DB-->>B: 確認結果
    B->>DB: サイト情報更新（HTML/CSS/JSを含む）
    DB-->>B: 更新完了
    B-->>F: 更新完了レスポンス
    F-->>U: 更新完了メッセージ表示
```

#### 処理フロー（削除）

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: 削除ボタンクリック
    F-->>U: 確認ダイアログ表示
    U->>F: 削除確認
    F->>F: JWTトークン取得
    F->>B: サイト削除リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: サイト所有者確認
    DB-->>B: 確認結果
    B->>DB: サイト情報削除
    DB-->>B: 削除完了
    B-->>F: 削除完了レスポンス
    F-->>U: サイト一覧画面へ遷移
```

### ユーザー設定

#### 機能概要

ユーザー情報の表示・編集機能

#### 画面遷移

1. サイドバーの「ユーザー設定」をクリック
2. ユーザー設定画面に遷移
3. 「編集」ボタンをクリック
4. ユーザー情報編集画面に遷移
5. 情報を編集し「更新する」ボタンをクリック

#### 入力項目（ユーザー情報編集画面）

| 項目名                   | 必須 | 型・制約                | バリデーション     | 説明                           |
| ------------------------ | ---- | ----------------------- | ------------------ | ------------------------------ |
| ユーザー名               | ○    | 文字列（最大 50 文字）  | -                  | 表示名として使用               |
| メールアドレス           | ○    | 文字列（最大 255 文字） | メールアドレス形式 | ログイン ID、連絡先として使用  |
| 現在のパスワード         | ○    | 文字列（8〜32 文字）    | -                  | 変更確認用                     |
| 新しいパスワード         | ×    | 文字列（8〜32 文字）    | 英数字記号混在     | 新しいパスワード（変更時のみ） |
| 新しいパスワード（確認） | ×    | 文字列（8〜32 文字）    | パスワードと一致   | 確認用（変更時のみ）           |

#### 処理フロー

```mermaid
sequenceDiagram
    participant U as ユーザー
    participant F as フロントエンド
    participant B as バックエンドAPI
    participant DB as データベース

    U->>F: ユーザー設定画面表示リクエスト
    F->>F: JWTトークン取得
    F->>B: ユーザー情報取得リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: ユーザー情報照会
    DB-->>B: ユーザー情報
    B-->>F: ユーザー情報
    F-->>U: ユーザー情報表示
    U->>F: 編集ボタンクリック
    F-->>U: ユーザー情報編集画面表示
    U->>F: ユーザー情報編集
    F->>F: 入力値検証
    F->>F: JWTトークン取得
    F->>B: ユーザー情報更新リクエスト（JWT付与）
    B->>B: JWTトークン検証
    B->>DB: 現在のパスワード検証
    DB-->>B: 検証結果
    B->>DB: ユーザー情報更新
    DB-->>B: 更新完了
    B-->>F: 更新完了レスポンス（新JWTトークン含む）
    F->>F: 新JWTトークンを保存
    F-->>U: ユーザー設定画面へ遷移
```
